<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="980" viewBox="0 0 1600 980">
  <defs>
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L12,6 L0,12 z" fill="#475569" />
    </marker>
    <style>
      .title { font: 700 30px 'Segoe UI','Microsoft YaHei',sans-serif; fill:#0f172a; }
      .subtitle { font: 500 16px 'Segoe UI','Microsoft YaHei',sans-serif; fill:#334155; }
      .h { font: 700 18px 'Segoe UI','Microsoft YaHei',sans-serif; fill:#0f172a; }
      .t { font: 500 14px 'Segoe UI','Microsoft YaHei',sans-serif; fill:#1e293b; }
      .small { font: 500 13px 'Segoe UI','Microsoft YaHei',sans-serif; fill:#475569; }
      .card { fill:#ffffff; stroke:#cbd5e1; stroke-width:1.5; rx:12; ry:12; }
      .zoneA { fill:#f8fafc; stroke:#94a3b8; stroke-width:1.5; rx:16; ry:16; }
      .zoneB { fill:#eff6ff; stroke:#60a5fa; stroke-width:1.5; rx:16; ry:16; }
      .zoneC { fill:#f0fdf4; stroke:#4ade80; stroke-width:1.5; rx:16; ry:16; }
      .api { fill:#ecfeff; stroke:#22d3ee; stroke-width:1.5; rx:12; ry:12; }
      .line { stroke:#475569; stroke-width:2.2; fill:none; marker-end:url(#arrow); }
      .dash { stroke:#0ea5e9; stroke-width:2; fill:none; marker-end:url(#arrow); stroke-dasharray:7 6; }
    </style>
  </defs>

  <rect x="0" y="0" width="1600" height="980" fill="#f8fafc" />

  <text x="44" y="58" class="title">系统提示词管理页优化方案（AI 生成 + 编辑增强）</text>
  <text x="44" y="88" class="subtitle">目标：新增可 AI 辅助生成/优化，编辑过程具备预览、对比、质量评估与可控保存</text>

  <!-- Left zone: User -->
  <rect x="40" y="130" width="360" height="780" class="zoneA" />
  <text x="62" y="168" class="h">1) 用户交互层</text>

  <rect x="62" y="204" width="316" height="118" class="card" />
  <text x="82" y="236" class="h">入口</text>
  <text x="82" y="264" class="t">- 点击“系统上下文设置”</text>
  <text x="82" y="286" class="t">- 新建 or 编辑 existing prompt</text>

  <rect x="62" y="344" width="316" height="190" class="card" />
  <text x="82" y="376" class="h">需求输入（新建向导）</text>
  <text x="82" y="404" class="t">- 场景：编程/翻译/写作/客服...</text>
  <text x="82" y="426" class="t">- 风格：简洁/专业/严格</text>
  <text x="82" y="448" class="t">- 约束：语言/格式/禁止项</text>
  <text x="82" y="470" class="t">- 候选数：1~3</text>
  <text x="82" y="500" class="small">输入可复用为模板</text>

  <rect x="62" y="560" width="316" height="160" class="card" />
  <text x="82" y="592" class="h">人工决策</text>
  <text x="82" y="620" class="t">- 采纳候选 / 再优化</text>
  <text x="82" y="642" class="t">- 查看评分与警告</text>
  <text x="82" y="664" class="t">- 确认后保存</text>

  <rect x="62" y="744" width="316" height="140" class="card" />
  <text x="82" y="776" class="h">关键原则</text>
  <text x="82" y="804" class="t">AI 给建议，不自动覆盖原文</text>
  <text x="82" y="826" class="t">保存动作始终由用户触发</text>

  <!-- Middle zone: Frontend -->
  <rect x="440" y="130" width="560" height="780" class="zoneB" />
  <text x="462" y="168" class="h">2) 前端（chat_app）</text>

  <rect x="464" y="204" width="512" height="128" class="card" />
  <text x="486" y="236" class="h">SystemContextEditor V2（主容器）</text>
  <text x="486" y="264" class="t">- 保留 list/create/edit 主流程</text>
  <text x="486" y="286" class="t">- 新增 AI 辅助状态机（idle/loading/candidate/error）</text>

  <rect x="464" y="352" width="244" height="190" class="card" />
  <text x="486" y="384" class="h">Wizard 面板</text>
  <text x="486" y="412" class="t">- 结构化收集需求</text>
  <text x="486" y="434" class="t">- 支持模板快速填充</text>
  <text x="486" y="456" class="t">- 提交 generate 请求</text>

  <rect x="732" y="352" width="244" height="190" class="card" />
  <text x="754" y="384" class="h">AI 助手面板</text>
  <text x="754" y="412" class="t">- 候选列表 + 亮点说明</text>
  <text x="754" y="434" class="t">- 一键“更简洁/更严格”</text>
  <text x="754" y="456" class="t">- 失败重试 + 降级提示</text>

  <rect x="464" y="566" width="512" height="186" class="card" />
  <text x="486" y="598" class="h">编辑区增强</text>
  <text x="486" y="626" class="t">- 标签页：编辑 / 预览 / 对比</text>
  <text x="486" y="648" class="t">- 快捷动作：AI 优化、补全边界、长度控制</text>
  <text x="486" y="670" class="t">- 质量卡：clarity、constraint、risk、verbosity</text>
  <text x="486" y="700" class="small">首版可基于 textarea + markdown preview 实现</text>

  <rect x="464" y="772" width="512" height="112" class="card" />
  <text x="486" y="804" class="h">Store / API 侧扩展</text>
  <text x="486" y="832" class="t">新增 actions：generateDraft / optimizeDraft / evaluateDraft</text>
  <text x="486" y="854" class="t">复用原有 create/update/activate 持久化链路</text>

  <!-- Right zone: Backend -->
  <rect x="1040" y="130" width="520" height="780" class="zoneC" />
  <text x="1062" y="168" class="h">3) 后端（chat_app_server_rs）</text>

  <rect x="1064" y="204" width="472" height="146" class="api" />
  <text x="1086" y="236" class="h">提示词助手 API（新增）</text>
  <text x="1086" y="264" class="t">POST /api/system-contexts/ai/generate</text>
  <text x="1086" y="286" class="t">POST /api/system-contexts/ai/optimize</text>
  <text x="1086" y="308" class="t">POST /api/system-contexts/ai/evaluate</text>

  <rect x="1064" y="370" width="472" height="212" class="card" />
  <text x="1086" y="402" class="h">提示词助手服务（建议新增）</text>
  <text x="1086" y="430" class="t">1. 模板组装：角色/目标/边界/格式</text>
  <text x="1086" y="452" class="t">2. 模型路由：复用现有 AI model config</text>
  <text x="1086" y="474" class="t">3. 安全护栏：敏感项、冲突约束、长度限制</text>
  <text x="1086" y="496" class="t">4. 结构化输出：content + score + warnings</text>
  <text x="1086" y="526" class="small">失败时返回可读错误 + 前端可重试信号</text>

  <rect x="1064" y="606" width="472" height="120" class="card" />
  <text x="1086" y="638" class="h">现有 CRUD 继续承担最终保存</text>
  <text x="1086" y="666" class="t">/api/system-contexts (create/update/delete/activate)</text>
  <text x="1086" y="688" class="t">仅用户确认后写库，避免 AI 自动落库</text>

  <rect x="1064" y="748" width="472" height="136" class="card" />
  <text x="1086" y="780" class="h">数据层建议</text>
  <text x="1086" y="808" class="t">新增 system_context_versions（支持回滚与对比）</text>
  <text x="1086" y="830" class="t">可选：quality_score / quality_report 字段</text>
  <text x="1086" y="852" class="t">保留 system_contexts 主表兼容旧逻辑</text>

  <!-- Arrows -->
  <path d="M380 266 L456 266" class="line" />
  <path d="M380 438 L456 438" class="line" />
  <path d="M708 438 L732 438" class="line" />

  <path d="M976 438 L1064 278" class="dash" />
  <text x="988" y="350" class="small">AI 调用</text>

  <path d="M1064 330 L976 490" class="dash" />
  <text x="986" y="462" class="small">候选/评分/警告</text>

  <path d="M976 660 L1064 660" class="line" />
  <text x="986" y="646" class="small">确认保存</text>

  <path d="M536 754 L536 770" class="line" />

  <!-- Footer -->
  <text x="44" y="946" class="subtitle">建议实施顺序：阶段 1（AI 生成 + 预览）→ 阶段 2（对比 + 优化动作）→ 阶段 3（版本库 + 评分体系）</text>
</svg>
